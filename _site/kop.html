<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="REST endpoints">
<meta name="keywords" content="develop,  develop">
<title>Developing with DM+D resources | NHS DM+D API</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>
<script src="js/image-map.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="icon" type="image/png"  href="images/favicon.png">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4005feed.xml">




    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> NHS DM+D API</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="news.html">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="http://www.google.com/" target="_blank">External Link 1</a></li>
                        
                        
                        
                        <li><a href="http://www.yahoo.com/" target="_blank">External Link 2</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Developing with DM+D resources">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
            <a href="https://github.com/github_account/github_repo" target="_blank" class="fa fa-github fa-lg navbar-brand no_icon pull-right" aria-hidden="true">&nbsp;</a>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          








<ul id="mysidebar" class="nav">
	<img src="images/logo.png" alt="NHS Digital Logo"/>
    <li class="sidebarTitle">DM+D API<br/> 1.0.0-alpha.1</li>
    
    
    
    <li>
        <a href="#">Get Started</a>
        <ul>
            
            
            
            <li><a href="index.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="overview_workshops.html">Workshops</a></li>
            
            
            
            
            
            
            <li><a href="overview_glossary.html">Glossary</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Develop</a>
        <ul>
            
            
            
            <li><a href="develop_overview.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="data_download.html">Data Download</a></li>
            
            
            
            
            
            
            <li><a href="rest_endpoints.html">REST Endpoints</a></li>
            
            
            
            
            
            
            <li><a href="rest_endpoints_reference.html">REST Endpoints Reference</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Deploy</a>
        <ul>
            
            
            
            <li><a href="deploy_overview.html">Overview</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
         

<div class="post-header">
   <h1 class="post-title-main">Developing with DM+D resources</h1>
</div>



<div class="post-content">

   
    <div class="summary">REST endpoints</div>
   

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    

  <h1 id="extracting-eps-message-data-for-a-clinical-safety-pack">Extracting EPS Message Data for a Clinical Safety Pack</h1>
<h2 id="introduction">Introduction</h2>
<p>When changes are introduced in dispensing and prescribing systems a clinical safety pack containing the contents of EPS messages relating to a given number of prescribed items is produced for review by an EPS clinician. The purpose of this is for the structure of the messages to be checked by Solutions Assurance tooling (currently TKW) and for the messages’ clinical content to be reviewed.
Historically the extract and input process has been complicated as it required suppliers to extract from their systems, anonymise and send. This often resulted in wrongly encoded or extracted messages and difficulty delivering due to size.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>Access to Spine audit logs</li>
  <li>Access to Cherwell or ability to raise service requests</li>
  <li>Prescriptions issued within the last 56 days</li>
</ul>

<h2 id="process">Process</h2>
<p>The process should be similar for both dispensing and prescribing systems:</p>

<ol>
  <li>Identify the test systems</li>
  <li>Get the internalIDs of prescription upload or download messages for prescribing and dispensing systems respectively</li>
  <li>Get the prescription IDs for created/downloaded prescriptions</li>
  <li>Get the internalIDs for EPS messages relating to the identified prescription IDs</li>
  <li>Raise a service request for Spine operations to extract the messages with those internalIDs</li>
  <li>Spine ops team curl the identified messages from the event source (message store) and run an XSLT which removes patient details</li>
</ol>

<h3 id="pharmacy-messaging">Pharmacy Messaging</h3>
<p>Identify the ODS code and time period for message capture
Get the ASID for the ODS codes by searching SDS for:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>(&amp;(nhsidcode={ODS code}})(objectclass=nhsas)) 
</code></pre>
</div>
<p>and noting the <em>dn</em> attribute for the appropriate system - this is the ASID.</p>

<p>List the nominated prescription download messages by running:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>index=spine* outboundInteractionID=PORX_IN070101UK31 messageSender={asid} | table internalID
</code></pre>
</div>
<p>This should be a small time period as is likely to be a large number. Messages are archived after 56 days so prescriptions should be more recent thatn this. Once the search is finished extract and save the data.</p>

<p>Get the prescription IDs in nominated DLs by searching over the same time period:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>index=spinevfm* logReference=EPS0271 prescriptionID [search index=spinevfm* outboundInteractionID=PORX_IN070101UK31 messageSender={asid} | table internalID]| stats count by prescriptionID | fields + prescriptionID
</code></pre>
</div>
<p>Once the search is finished extract the data.</p>

<p>From the saved list of prescriptionIDs generate prescription ID query strings (e.g. in Excel) of the form <em>8FA0EC-B84005-BE7FD OR 934DD7-B85020-D46B5 OR 935B48-C86038-082ED… OR {prescription n}</em></p>

<p>List the messages relating to these prescriptions by searching for:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>index=spine* (Process=porx_in090101uk31_w* OR  Process=porx_in080101uk31_w* {...OR any other interaction IDs here}) logReference=EPS0139 0203FE-E87738-36530 OR ... FB5F63-E87013-3D4D3 OR FF7D72-E87738-36BC5 | table internalID
</code></pre>
</div>
<p>There is a limit to the size of the query, so it may be necessary to query in batches of say 400 prescription IDs.
The query time period should be any time after the prescription download.</p>

<p>Cat all of the output together te
Raise a service request with Spine core requesting</p>


    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    <img class="pull-left" src="images/explanatoryline.png" alt="NHS Digital Explanatory Line"/>
                    <br/>
                    &copy;2017 NHS Digital<br />
                     Site last generated: Mar 3, 2017 <br />
                    9f7f8750d3451e1b64f2b2b866e8656153a2f011<br/>
                    <br/>
                    <!-- OGL Licence -->
                    <div class="open-government-licence">
                        <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon"><img src="images/licence/ogl-symbol-41px-retina-black.png"></img></a>
                        <p>All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon">Open Government Licence v3.0</a>, except where otherwise stated</p>
                    </div>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

</html>