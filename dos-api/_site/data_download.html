<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Download complete DM+D releases in an immediately useful format via the API">
<meta name="keywords" content="develop,  develop">
<title>Download DM+D data | NHS DM+D API</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>
<script src="js/image-map.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="icon" type="image/png"  href="images/favicon.png">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="https://nhsconnect.github.io/spine-eps-trackerfeed.xml">




    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> NHS DM+D API</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="news.html">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="http://www.google.com/" target="_blank">External Link 1</a></li>
                        
                        
                        
                        <li><a href="http://www.yahoo.com/" target="_blank">External Link 2</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Download DM+D data">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
            <a href="https://github.com/github_account/github_repo" target="_blank" class="fa fa-github fa-lg navbar-brand no_icon pull-right" aria-hidden="true">&nbsp;</a>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          








<ul id="mysidebar" class="nav">
	<img src="images/logo.png" alt="NHS Digital Logo"/>
    <li class="sidebarTitle">DM+D API<br/> 1.0.0-alpha.1</li>
    
    
    
    <li>
        <a href="#">Get Started</a>
        <ul>
            
            
            
            <li><a href="index.html">Introduction</a></li>
            
            
            
            
            
            
            <li><a href="overview_workshops.html">Workshops</a></li>
            
            
            
            
            
            
            <li><a href="overview_glossary.html">Glossary</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Develop</a>
        <ul>
            
            
            
            <li><a href="develop_overview.html">Overview</a></li>
            
            
            
            
            
            
            <li class="active"><a href="data_download.html">Data Download</a></li>
            
            
            
            
            
            
            <li><a href="rest_endpoints.html">REST Endpoints</a></li>
            
            
            
            
            
            
            <li><a href="rest_endpoints_reference.html">REST Endpoints Reference</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Deploy</a>
        <ul>
            
            
            
            <li><a href="deploy_overview.html">Overview</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
         

<div class="post-header">
   <h1 class="post-title-main">Download DM+D data</h1>
</div>



<div class="post-content">

   
    <div class="summary">Download complete DM+D releases in an immediately useful format via the API</div>
   

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    

  <h1 id="data-download">Data Download</h1>

<p>The API transforms each DM+D release into a number of formats which are suitable for immediate use. This page provides inforamtion on these formats, and ways to download them.</p>

<p>Other formats can be produced: where users do further transforms or processing on releases they are encouraged to share their transforms which can be incorporated into the API and used to produce further formats.</p>

<h2 id="api-key-registration">API Key Registration</h2>

<p>Applications are required to register for and use an API key for all DM+D API access, this includes data downloads.</p>

<h2 id="data-formats">Data Formats</h2>
<p>Data is transformed into and available in the following formats. Files are bundled and compressed in the zip format.</p>

<h3 id="csv">CSV</h3>
<p>Comma separated value</p>

<h4 id="schema">Schema</h4>
<p>ISO SQL DDL, with one table per CSV file.</p>

<h3 id="xml">XML</h3>
<p>The original XML files as held on TRUD. Schemas are included in the zip archive.</p>

<h3 id="json">JSON</h3>
<p>JSON files following the same schema as documented in the REST resources reference. There is one file per resource type.</p>

<h3 id="rdf">RDF</h3>
<p>TODO</p>
<h4 id="schema-1">Schema</h4>
<p>TODO</p>

<h2 id="accessing-the-data">Accessing the Data</h2>
<p>Data can currently be accessed via:</p>

<ul>
  <li>[x] HTTP</li>
  <li>[x] AWS S3 sync</li>
  <li>[ ] Torrent</li>
  <li>[ ] sftp</li>
  <li>[ ] ssh</li>
  <li>[ ] rsync</li>
</ul>

<h3 id="http">HTTP</h3>
<p>The most recent release of the data should always be available at: [http://dmd.ebor.tech/nhsdmdrelease/v0.0.1/data/latest/{format}], where format is one of:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>csv
xml
json
rdf
</code></pre>
</div>

<p>Individual relases are available at http://dmd.ebor.tech/nhsdmdrelease/v0.0.1/data/{releasenumber}/{format}, for example [http://dmd.ebor.tech/nhsdmdrelease/v0.0.1/data/2.2.0/rdf] contains the rdf format data for release 2.2.0.</p>

<p>All requests must include an API key in the Authorization header. Response to this request will be a 302 Redirect to the data.</p>

<h3 id="example">Example</h3>
<p>The example below</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl -H "Authorization: MYAPIKEY123" http://dmd.ebor.tech/nhsdmdrelease/v0.0.1/data/2.2.0/rdf
</code></pre>
</div>

<h2 id="aws-s3-sync">AWS S3 Sync</h2>
<p>The releases are held in the <em>nhsdmdrelase</em> AWS S3 bucket. This means that they can easily (and cheaply) be mirrored to another S3 bucket by using the aws SDK or cli tools. Before accessing the data you will need to request a temporary access token from the <em>/data_auth</em> resource, passing it your API key and AWS principal. This will allow read access to the S3 bucket for an hour.</p>

<p>The layout of the bucket is:</p>

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Content</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>nhsdmdrelase/{release}/*</td>
      <td>unzipped raw files from TRUD</td>
    </tr>
    <tr>
      <td>nhsdmdrelease/{release}/.work/*</td>
      <td>intermediate files used in transforming the data and can be ignored</td>
    </tr>
    <tr>
      <td>nhsdmdrelease/v0.0.1/schema/{format}/*</td>
      <td>schema files for the respective format, which are included in compressed bundles</td>
    </tr>
    <tr>
      <td>nhsdmdrelease/v0.0.1/{release|latest}/{format}</td>
      <td>bundled compressed content in the respective format</td>
    </tr>
    <tr>
      <td>nhsdmdrelease/v0.0.1/{release|latest}/{format}/*</td>
      <td>uncompressed individual files in the respective format</td>
    </tr>
  </tbody>
</table>

<h3 id="examples">Examples</h3>
<p>Once you have a temporary access token the <em>nhsdmdrelease</em> bucket can be browsed from the AWS console, and synched or pulled using AWS cli or SDK as shown below.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>aws s3 sync <span class="k">$(</span>curl -H <span class="s2">"Authorization: MYAPIKEY123"</span> https://dmd.ebor.tech/nhsdmdrelease/v0.0.1/data_auth/raw<span class="k">)</span> s3://nhsdmdrelease/v0.0.1/latest/csv s3://mypharmacy/dmd
</code></pre>
</div>

<p>or</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">boto</span>

<span class="n">AWS_ACCESS_KEY</span> <span class="o">=</span> <span class="s">'Your access key'</span>
<span class="n">AWS_SECRET_KEY</span> <span class="o">=</span> <span class="s">'Your secret key'</span>
<span class="n">DEST_BUCKET_NAME</span> <span class="o">=</span> <span class="s">'mypharmacy'</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">S3Connection</span><span class="p">(</span><span class="n">AWS_ACCESS_KEY</span><span class="p">,</span> <span class="n">AWS_SECRET_KEY</span><span class="p">)</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">'nhsdmdrelease'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bucket</span><span class="p">:</span>
    <span class="n">bucket</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">DEST_BUCKET_NAME</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</code></pre>
</div>



    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    <img class="pull-left" src="images/explanatoryline.png" alt="NHS Digital Explanatory Line"/>
                    <br/>
                    &copy;2017 NHS Digital<br />
                     Site last generated: Aug 20, 2017 <br />
                    HEAD<br/>
                    <br/>
                    <!-- OGL Licence -->
                    <div class="open-government-licence">
                        <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon"><img src="images/licence/ogl-symbol-41px-retina-black.png"></img></a>
                        <p>All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license" class="no_icon">Open Government Licence v3.0</a>, except where otherwise stated</p>
                    </div>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

</html>